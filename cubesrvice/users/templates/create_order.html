<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Confirm Order</title>
{% load static %}

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<link rel="stylesheet" href="{% static 'css/style.css' %}">

<style>
body{
    background:#f4f6f9;
    font-family:'Segoe UI',sans-serif;
}

/* LAYOUT */
.order-container{
    max-width:1100px;
    margin:40px auto;
    display:grid;
    grid-template-columns:2fr 1fr;
    gap:25px;
    padding-top: 100px;
}

/* CARD */
.order-left,.order-right{
    background:#fff;
    padding:25px;
    border-radius:12px;
    box-shadow:0 8px 20px rgba(0,0,0,0.08);
}

/* SECTION TITLE */
.section-title{
    font-size:20px;
    font-weight:600;
    margin-bottom:18px;
    border-bottom:2px solid #f0f0f0;
    padding-bottom:8px;
}

/* FORM GRID */
.address-grid{
    display:grid;
    grid-template-columns:1fr 1fr;
    gap:15px;
}

/* FULL WIDTH */
.full-width{
    grid-column:1 / -1;
}

/* LABEL */
.form-group label{
    font-size:13px;
    font-weight:600;
    margin-bottom:4px;
    display:block;
    color:#555;
}

/* INPUT */
.form-group input,
.form-group textarea{
    width:100%;
    padding:12px;
    border:1px solid #ddd;
    border-radius:8px;
    font-size:14px;
    background:#f9f9f9;
}

.form-group input:focus,
.form-group textarea:focus{
    outline:none;
    border-color:#ff9800;
    background:#fff;
}

/* BUTTONS */
.place-order-btn{
    width:100%;
    padding:14px;
    border:none;
    border-radius:8px;
    font-size:16px;
    font-weight:600;
    cursor:pointer;
    margin-top:10px;
}

.edit-btn{background:#2196f3;color:#fff;}
.save-btn{background:#4caf50;color:#fff;}
.order-btn{background:#ff9800;color:#fff;}

.edit-btn:hover{background:#1976d2;}
.save-btn:hover{background:#388e3c;}
.order-btn:hover{background:#fb8c00;}

/* CART ITEM */
.cart-item{
    display:flex;
    gap:15px;
    padding:12px 0;
    border-bottom:1px solid #eee;
}

.cart-item img{
    width:80px;
    height:80px;
    object-fit:cover;
    border-radius:8px;
}

/* PRICE */
.price-row{
    display:flex;
    justify-content:space-between;
    margin-bottom:10px;
}

/* MOBILE */
@media(max-width:900px){
    .order-container{grid-template-columns:1fr;}
    .address-grid{grid-template-columns:1fr;}
}
</style>
</head>

<body>

{% include 'header.html' %}

<!-- ‚úÖ form action points to create_order view -->
<form method="post" action="{% url 'users:create_order' %}">
{% csrf_token %}

<div class="order-container">

<!-- LEFT -->
<div class="order-left">

<div class="section-title">Delivery Address</div>

<div class="address-grid">

    <div class="form-group">
        <label>Full Name</label>
        <input type="text" name="fullname" value="{{ profile.fullname }}" readonly required>
    </div>

    <div class="form-group">
        <label>Mobile Number</label>
        <input type="text" name="mobile" value="{{ profile.mobile }}" readonly required>
    </div>

    <div class="form-group">
        <label>Email</label>
        <input type="email" name="email" value="{{ profile.email }}" readonly required>
    </div>

    <div class="form-group">
        <label>District</label>
        <input type="text" name="district" value="{{ profile.district }}" readonly required>
    </div>

    <div class="form-group full-width">
        <label>Complete Address</label>
        <textarea name="address" rows="3" readonly required>{{ profile.address }}</textarea>
    </div>

    <div class="form-group">
        <label>Pincode</label>
        <input type="text" name="pincode" value="{{ profile.pincode }}" readonly required>
    </div>

</div>

<button type="button" id="editBtn" class="place-order-btn edit-btn">
‚úèÔ∏è Edit Address
</button>

<button type="submit" name="save_profile" id="saveBtn" class="place-order-btn save-btn" style="display:none;">
üíæ Save Address
</button>

<div class="section-title" style="margin-top:25px;">Order Items</div>

{% if cart_items %}
    {% for item in cart_items %}
    <div class="cart-item">
        <img src="{{ item.image }}">
        <div>
            <h4>{{ item.service_name }}</h4>
            <p>{{ item.details }}</p>
              <p>{{ item.extra_details }}</p>
            <p>Qty: {{ item.quantity }}</p>
            <strong>‚Çπ{{ item.price }}</strong>
        </div>

        <!-- Hidden -->
        <input type="hidden" name="service_name[]" value="{{ item.service_name }}">
        <input type="hidden" name="service_details[]" value="{{ item.service_details }}">
        <input type="hidden" name="details[]" value="{{ item.details }}">
                <input type="hidden" name="extra_details[]" value="{{ item.extra_details }}">
        <input type="hidden" name="price[]" value="{{ item.price }}">
        <input type="hidden" name="quantity[]" value="{{ item.quantity }}">
        <input type="hidden" name="image[]" value="{{ item.image }}">
    </div>
    {% endfor %}
{% else %}
    <p>Your cart is empty.</p>
{% endif %}

</div>

<!-- RIGHT -->
<div class="order-right">

<div class="section-title">Price Details</div>

<div class="price-row">
    <span>Subtotal</span>
    <strong>‚Çπ{{ total_price }}</strong>
</div>

<div class="price-row">
    <span>Delivery</span>
    <span style="color:green;">FREE</span>
</div>

<hr>

<div class="price-row" style="font-size:18px;">
    <strong>Total</strong>
    <strong>‚Çπ{{ total_price }}</strong>
</div>

<label>Service Date</label>
<input type="date" name="date" required/>

<input type="hidden" name="total_price" value="{{ total_price }}">

<button type="submit" name="place_order" class="place-order-btn order-btn">
Place Order
</button>

</div>

</div>
</form>
{% include 'footer.html' %}
<script>
const editBtn = document.getElementById("editBtn");
const saveBtn = document.getElementById("saveBtn");

const fields = document.querySelectorAll(
    "input[name='fullname'],input[name='mobile'],textarea[name='address'],input[name='district'],input[name='pincode']"
);

editBtn.onclick = () => {
    fields.forEach(f => f.removeAttribute("readonly"));
    editBtn.style.display="none";
    saveBtn.style.display="block";
};
</script>

</body>
</html>
